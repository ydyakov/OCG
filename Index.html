<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8" />
    <title>Космическа совалка - Three.js</title>
    <style>
        body {
            margin: 0;
            background-color: black;
            overflow: hidden;
        }
    </style>
    <script type="importmap">
        {
          "imports": {
            "three": "https://unpkg.com/three@0.166.1/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.166.1/examples/jsm/"
          }
        }
    </script>
</head>
<body>
    <script type="module">
        import * as THREE from "three";

        const scene = new THREE.Scene();

        const camera = new THREE.PerspectiveCamera(
            60, window.innerWidth / window.innerHeight, 0.1, 1000
        );
        camera.position.z = 5;

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);


        var busterL = createBooster(0.3);
        scene.add(busterL);


        var busterR = createBooster(0.3);
        busterR.position.x += 2.5;
        scene.add(busterR);

        var tank = createTank(0.9);
        tank.position.x += 1.3;
        tank.position.y += 1;
        scene.add(tank);

    

        var shuttle = createShuttle(1);
        shuttle.position.x -= 0;
        scene.add(shuttle);

        // *********** functions ************************

        function createShuttle(r) {
            const h = r * 7;
            const shuttle = new THREE.Group();

            // Материали
            const mainMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff });
            const noseMaterial = new THREE.MeshStandardMaterial({ color: 0xaaaaaa });
            const backMaterial = new THREE.MeshStandardMaterial({ color: 0x9999ff });
            const materialBlue = new THREE.MeshStandardMaterial({ color: 0x0000ff });

            // тяло 
            const cylinderGeom = new THREE.CylinderGeometry(r, r, h, 32, 16, false, 0, Math.PI);
            const cylinderMesh = new THREE.Mesh(cylinderGeom, mainMaterial);
            shuttle.add(cylinderMesh);

            // нос
            const nouseH = h * 0.08;
            const nouseR = r * 0.85;
            const noseGeom = new THREE.CylinderGeometry(nouseR, r, nouseH, 32, 16, false, 0, Math.PI);
            const noseMesh = new THREE.Mesh(noseGeom, noseMaterial);
            noseMesh.position.y = ( h / 2) + (nouseH / 2);
            shuttle.add(noseMesh);

            // обло връхче на носа 
            const sphereNousGeom = new THREE.SphereGeometry(nouseR *1.04, 32, 16, 0, Math.PI, 0, Math.PI / 2);
            const sphereNousMesh = new THREE.Mesh(sphereNousGeom, noseMaterial);
            sphereNousMesh.position.y = (h / 2) + (nouseH / 2)  ; 
            sphereNousMesh.rotateY(Math.PI / 2);
            shuttle.add(sphereNousMesh);

            // опашка
            const hostShape = new THREE.Shape();
            ///// (y, x)
            hostShape.moveTo(0, 0);
            hostShape.lineTo(0, h * 0.16);
            hostShape.lineTo(r * 2 , h * 0.04);
            hostShape.lineTo(r * 2, 0);
            hostShape.lineTo(0, 0);

            const extrudeSettings = {
                steps: 1,
                depth: 0.1,
                bevelEnabled: false,
            };

            const hostGeom = new THREE.ExtrudeGeometry(hostShape, extrudeSettings);
            const hostMesh = new THREE.Mesh(hostGeom, mainMaterial);
            hostMesh.position.y = - (h / 2);
            shuttle.add(hostMesh);

            // долно крило
            // опашка
            const wingShape = new THREE.Shape();
            ///// (x, y)
            wingShape.moveTo(0, 0);
            wingShape.lineTo(r * 4.1, 0);
            wingShape.lineTo(r * 3.9, r);
            wingShape.lineTo(r * 1.8, h * 0.4);
            wingShape.lineTo(r , h * 0.85);
            //------
            wingShape.lineTo(-r, h * 0.85);
            wingShape.lineTo(-(r * 1.8), h * 0.4);
            wingShape.lineTo(- (r * 3.9), r);
            wingShape.lineTo(- (r * 4.1), 0);
            wingShape.lineTo(0, 0);

            const wingGeom = new THREE.ExtrudeGeometry(wingShape, extrudeSettings);
            const wingMesh = new THREE.Mesh(wingGeom, materialBlue);
            wingMesh.position.y = - (h / 2);
            wingMesh.rotateY(Math.PI / 2);
            shuttle.add(wingMesh);


            debugger;
            shuttle.rotateY(- Math.PI / 2);
            return shuttle;
            
        }

        function createTank(r) {
            const h = r * 3;
            const tank = new THREE.Group();

            // Материали
            const matBody = new THREE.MeshPhongMaterial({ color: 0xff8800 }); // оранжев NASA цвят

            //  цилиндър 
            const cylGeom = new THREE.CylinderGeometry(r, r, h, 32);
            const body = new THREE.Mesh(cylGeom, matBody);
            tank.add(body);

            //  Долна полусфера 
            const sphereBottomGeom = new THREE.SphereGeometry(r, 32, 16, 0, Math.PI * 2, 0, Math.PI / 2);
            const sphereBottom = new THREE.Mesh(sphereBottomGeom, matBody);
            sphereBottom.position.y = -h / 2; 
            sphereBottom.rotation.x = Math.PI; 
            tank.add(sphereBottom);

            // Горна издължена полусфера 
            const sphereTopGeom = new THREE.SphereGeometry(r, 32, 16, 0, Math.PI * 2, 0, Math.PI / 2);
            const sphereTop = new THREE.Mesh(sphereTopGeom, matBody);
            sphereTop.position.y = h / 2; 
            sphereTop.scale.y = 1.8; 
            tank.add(sphereTop);

            return tank;
        }

        function createBooster(r) {
            const h = r * 8;
            const booster = new THREE.Group();

            // Материали
            const matMain = new THREE.MeshPhongMaterial({ color: 0xffffff });
            const matTip = new THREE.MeshPhongMaterial({ color: 0xdddddd });
            const matBottomOut = new THREE.MeshPhongMaterial({ color: 0xff6600, side: THREE.FrontSide });
            const matBottomIn = new THREE.MeshPhongMaterial({ color: 0x222222, side: THREE.BackSide });

            // --- Цилиндър (основно тяло)
            const cylGeom = new THREE.CylinderGeometry(r, r, h, 32); 
            const cyl = new THREE.Mesh(cylGeom, matMain);
            booster.add(cyl);

            // --- Горен конус (върхът)
            const coneGeom = new THREE.ConeGeometry(r , r * 1.2, 32);
            const cone = new THREE.Mesh(coneGeom, matTip);
            cone.position.y = h / 2 + (r * 1.2) / 2; // поставяме го върху цилиндъра
            booster.add(cone);

            // --- Долен пресечен конус (дюзата)
            const engingGeom = new THREE.CylinderGeometry(r * 1, r * 1.3, r, 32, 1, true);
            const engingGeomMeshOut = new THREE.Mesh(engingGeom, matBottomOut);
            const engingGeomMeshIn = new THREE.Mesh(engingGeom, matBottomIn);
            const enginGroup = new THREE.Group();
            enginGroup.add(engingGeomMeshOut);
            enginGroup.add(engingGeomMeshIn);
                   
            enginGroup.position.y = -h / 2 - (r) / 2; // под цилиндъра

            booster.add(enginGroup);

            return booster;
        }


        // *************************************
        import { OrbitControls } from "three/addons/controls/OrbitControls.js";

        // Добави това след като създадеш camera и renderer
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; // по-плавно движение
        controls.dampingFactor = 0.05;

        animate();

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        window.addEventListener("resize", () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
